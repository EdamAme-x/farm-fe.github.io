"use strict";(self.webpackChunkfarm_docs=self.webpackChunkfarm_docs||[]).push([[8738],{9613:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>f});var i=t(9496);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=i.createContext({}),u=function(e){var n=i.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=u(e.components);return i.createElement(o.Provider,{value:n},e.children)},m="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},c=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=u(t),c=r,f=m["".concat(o,".").concat(c)]||m[c]||g[c]||a;return t?i.createElement(f,l(l({ref:n},p),{},{components:t})):i.createElement(f,l({ref:n},p))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,l=new Array(a);l[0]=c;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s[m]="string"==typeof e?e:r,l[1]=s;for(var u=2;u<a;u++)l[u]=t[u];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}c.displayName="MDXCreateElement"},9980:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>g,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var i=t(1163),r=(t(9496),t(9613));const a={},l="Using Plugins",s={unversionedId:"using-plugins",id:"using-plugins",title:"Using Plugins",description:"There are 4 kinds of plugins supported in Farm:",source:"@site/docs/using-plugins.md",sourceDirName:".",slug:"/using-plugins",permalink:"/docs/using-plugins",draft:!1,editUrl:"https://github.com/farm-fe/farm-fe.github.io/tree/main/docs/using-plugins.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Why Farm?",permalink:"/docs/why-farm"},next:{title:"Overview",permalink:"/docs/tutorials/overview"}},o={},u=[{value:"Farm Compilation Plugins",id:"farm-compilation-plugins",level:2},{value:"Using Rust Plugins",id:"using-rust-plugins",level:3},{value:"Using Js Plugins",id:"using-js-plugins",level:3},{value:"Using Vite Plugins In Farm",id:"using-vite-plugins-in-farm",level:2},{value:"Farm Runtime Plugin",id:"farm-runtime-plugin",level:2},{value:"Using SWC Plugins",id:"using-swc-plugins",level:2}],p={toc:u},m="wrapper";function g(e){let{components:n,...t}=e;return(0,r.kt)(m,(0,i.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"using-plugins"},"Using Plugins"),(0,r.kt)("p",null,"There are 4 kinds of plugins supported in Farm:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"Farm Compilation Plugins")),": Both Rust plugins and Js Plugins, which adopt a rollup-style hooks."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"Vite Plugin")),": Vite plugins are supported in Farm out of Box"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"Farm Runtime Plugin")),": Adding abilities for Farm's runtime system."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"Swc Plugins")),": Swc plugins are supported in Farm out of Box.")),(0,r.kt)("p",null,"Farm adopt Vite/Rollup ecosystem, Vite/Rollup Plugins can be used directly in Farm."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"For how to write your own plugins, refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/plugins/overview"},"Plugins"))),(0,r.kt)("h2",{id:"farm-compilation-plugins"},"Farm Compilation Plugins"),(0,r.kt)("p",null,"First, install the plugins your need, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pnpm add -D @farmfe/plugin-sass @farmfe/js-plugin-postcss\n")),(0,r.kt)("p",null,"Using ",(0,r.kt)("inlineCode",{parentName:"p"},"plugins")," to configure Farm compilation plugins:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="farm.config.ts"',title:'"farm.config.ts"'},'import farmPostcssPlugin from "@farmfe/js-plugin-postcss";\n\nexport default defineConfig({\n  // ...\n  plugins: [\n    // Rust plugin, configure its package name\n    "@farmfe/plugin-sass",\n    // Js plugin, configure the plugin object\n    farmPostcssPlugin()\n  ],\n});\n')),(0,r.kt)("p",null,"There are 2 kinds of Farm compilation plugins:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"Rust Plugins")),": which is written in Rust and has best performance."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"Js Plugins")),": which is written in JS/TS, and it's used for compatibility with current JS ecosystem")),(0,r.kt)("h3",{id:"using-rust-plugins"},"Using Rust Plugins"),(0,r.kt)("p",null,"Using ",(0,r.kt)("inlineCode",{parentName:"p"},"package name")," to configure a Rust Plugin, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="farm.config.ts"',title:'"farm.config.ts"'},'export default defineConfig({\n  // ...\n  plugins: [\n    // Rust plugin, configure its package name\n    "@farmfe/plugin-sass",\n  ],\n});\n')),(0,r.kt)("p",null,"For above example, Farm will resolve package ",(0,r.kt)("inlineCode",{parentName:"p"},"@farmfe/plugin-sass")," and treat it as a Farm Rust Plugin."),(0,r.kt)("p",null,"If you want to configure options for rust plugins, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"array syntax")," like ",(0,r.kt)("inlineCode",{parentName:"p"},"[packageName, optionsObject]"),", for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="farm.config.ts"',title:'"farm.config.ts"'},"export default defineConfig({\n  // ...\n  plugins: [\n    // using array syntax to configure a rust plugin\n    [\n      // rust plugin's name\n      \"@farmfe/plugin-sass\",\n      // rust plugin's options\n      {\n        additionalData: '@use \"@/global-variables.scss\";'\n      }\n    ],\n  ],\n});\n")),(0,r.kt)("p",null,"Currently Farm supports 2 rust plugins officially:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"@farmfe/plugin-react")),": Farm rust plugin for react jsx compilation and react-refresh injection."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"@farmfe/plugin-sass")),": Farm rust plugin for scss files compilation, uses ",(0,r.kt)("inlineCode",{parentName:"li"},"sass-embedded")," internally.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"To learn more about rust plugins, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/plugins/rust-plugin"},"Rust Plugins"))),(0,r.kt)("h3",{id:"using-js-plugins"},"Using Js Plugins"),(0,r.kt)("p",null,"Farm JS plugin is a JS object with methods as hooks, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="farm.config.ts"',title:'"farm.config.ts"'},'import farmPostcssPlugin from "@farmfe/js-plugin-postcss";\n\nexport default defineConfig({\n  plugins: [\n    // Js plugin, configure the plugin object\n    farmPostcssPlugin({\n      // ... configure postcss options\n    })\n  ],\n});\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"farmPostcssPlugin()")," returns a plugin object, and you can pass any postcss options by its arguments."),(0,r.kt)("p",null,"If you want to add a Farm JS plugin quickly, you can just configure a plugin object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="farm.config.ts"',title:'"farm.config.ts"'},"import readFileSync from 'fs';\n\nexport default defineConfig({\n  plugins: [\n    // configure a custom plugin\n    {\n      // plugin name, required\n      name: 'my-first-farm-plugin',\n      // this priority of this plugin, bigger value will be executed first, default to 100. \n      priority: 1000,\n      // define a load hook to determine how to load a more\n      load: {\n        // to improve performance, modules will be skipped if they don't match the filters.\n        filters: {\n          // only be executed for .png files.\n          resolvedPaths: ['\\\\.txt$']\n        },\n        // executor callback for this hook\n        executor: (params, context) => {\n          const { resolvedPath } = params;\n          const content = readFileSync(resolvedPath, 'utf-8');\n\n          return {\n            content: `export default '${content}'`,\n            moduleType: 'js'\n          }\n        }\n      }\n    }\n  ],\n});\n")),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"filters")," is required in Farm for js plugins. Because Js Plugin is really slow and we should avoid executing it as much as possible. For those modules that don't match the filters, Farm won't trigger js plugin hook for them at all! Which means Farm can handle them only on Rust side safely and concurrently.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"To learn more about Farm Js Plugins, refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/plugins/js-plugin"},"JS Plugin"))),(0,r.kt)("h2",{id:"using-vite-plugins-in-farm"},"Using Vite Plugins In Farm"),(0,r.kt)("p",null,"Farm supports Vite plugins out of Box. First you need to install vite plugins\uff0cfor example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pnpm add @vitejs/plugin-vue @vitejs/plugin-vue-jsx vite -D\n")),(0,r.kt)("p",null,"Then you can use vite plugins directly by ",(0,r.kt)("inlineCode",{parentName:"p"},"vitePlugins")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"farm.config.ts"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="farm.config.ts"',title:'"farm.config.ts"'},"import vue from '@vitejs/plugin-vue',\nimport vueJsx from '@vitejs/plugin-vue-jsx';\n\nexport default defineConfig({\n  // configuring vite plugins\n  vitePlugins: [\n    vue(),\n    vueJsx()\n  ]\n});\n")),(0,r.kt)("p",null,"To improve performance of vite plugins, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"function syntax")," that returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"filters"),", for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="farm.config.ts"',title:'"farm.config.ts"'},"import vue from '@vitejs/plugin-vue',\n\n// Using function syntax of Vite plugin\nfunction configureVitePluginVue() {\n  // return plugin and its filters\n  return {\n    // using plugin vue\n    vitePlugin: vue(),\n    // configuring filters for it. Unmatched module paths will be skipped.\n    filters: ['\\\\.vue$', '\\\\\\\\0.+']\n  };\n}\n\nexport default defineConfig({\n  // configuring vite plugins\n  vitePlugins: [\n    configureVitePluginVue\n  ]\n});\n")),(0,r.kt)("h2",{id:"farm-runtime-plugin"},"Farm Runtime Plugin"),(0,r.kt)("p",null,"Farm has a runtime module system to control how to load and execute modules. Configuring ",(0,r.kt)("inlineCode",{parentName:"p"},"compilation.runtime.plugins")," to add more runtime plugin, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export default defineConfig({\n  compilation: {\n    // configure Farm runtime module system\n    runtime: {\n      plugins: [\n        // a runtime plugin package\n        require.resolve('farm-plugin-runtime-mock'),\n        // a local runtime plugin\n        path.join(process.cwd(), \"build/runtime-plugin.ts\")\n      ]\n    }\n  }\n});\n")),(0,r.kt)("p",null,"you have to configure a path that point to your runtime plugin's entry. Recommend to a absolute path to avoid path issue."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"To learn more about runtime plugin refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/plugins/runtime-plugin"},"Runtime Plugin"))),(0,r.kt)("h2",{id:"using-swc-plugins"},"Using SWC Plugins"),(0,r.kt)("p",null,"Swc Plugin can also be used directly in Farm, Configuring ",(0,r.kt)("inlineCode",{parentName:"p"},"compilation.script.plugins")," to add SWC plugins, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import jsPluginVue from '@farmfe/js-plugin-vue';\n\n/**\n  * @type {import('@farmfe/core').UserConfig}\n  */\nexport default {\n   compilation: {\n     script: {\n       plugins: [{\n        // the package name of the swc plugin \n         name: 'swc-plugin-vue-jsx',\n         // options of this swc plugin\n         options: {\n           \"transformOn\": true,\n           \"optimize\": true\n         },\n         // plugin execute when the filters are matched.\n         filters: {\n           // resolvedPaths: [\".+\"]\n           moduleTypes: ['tsx', 'jsx'],\n         }\n       }]\n     }\n   },\n   plugins: [jsPluginVue()],\n};\n")),(0,r.kt)("p",null,"Each plugin item of the array contains three fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"name"),": the package name of the swc plugin"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"options"),": Configuration items passed to swc plugin"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"filters"),": Which modules to execute the plug-in, must be configured, support ",(0,r.kt)("inlineCode",{parentName:"li"},"resolvedPaths")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"moduleTypes")," these two filter items, if both are specified at the same time, take the union.")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"SWC plugin may not be compatible with the SWC version that Farm uses. If a error occurred, try upgrade the plugin. ")))}g.isMDXComponent=!0}}]);