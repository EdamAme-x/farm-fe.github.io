<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-api/rust-plugin-api" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Rust Plugin Api | Farm</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://farmfe.org/zh/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://farmfe.org/zh/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://farmfe.org/zh/docs/api/rust-plugin-api"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Rust Plugin Api | Farm"><meta data-rh="true" name="description" content="本文档仅涵盖插件钩子详情。 有关如何创建、构建和发布 rust 插件，请参阅：编写 Rust 插件"><meta data-rh="true" property="og:description" content="本文档仅涵盖插件钩子详情。 有关如何创建、构建和发布 rust 插件，请参阅：编写 Rust 插件"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://farmfe.org/zh/docs/api/rust-plugin-api"><link data-rh="true" rel="alternate" href="https://farmfe.org/docs/api/rust-plugin-api" hreflang="en"><link data-rh="true" rel="alternate" href="https://farmfe.org/zh/docs/api/rust-plugin-api" hreflang="zh"><link data-rh="true" rel="alternate" href="https://farmfe.org/docs/api/rust-plugin-api" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://G3J92PUFY2-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Farm RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Farm Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Farm" href="/zh/opensearch.xml"><link rel="stylesheet" href="/zh/assets/css/styles.4abb6b25.css">
<script src="/zh/assets/js/runtime~main.7b198934.js" defer="defer"></script>
<script src="/zh/assets/js/main.01376fc3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_IFS2" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_zV3U" role="banner"><div class="announcementBarPlaceholder_BaE1"></div><div class="content_Tvx2 announcementBarContent_FdcX">🎉 Farm is now in 1.0.0 stable and production ready. If you like Farm, give it a ⭐️ on <a target="_blank" rel="noopener noreferrer" href="https://github.com/farm-fe/farm">GitHub</a></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_QI_l announcementBarClose_NfjT"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logo.png" alt="My Site Logo" class="themedComponent_xQWO themedComponent--light_Flgq"><img src="/zh/img/logo.png" alt="My Site Logo" class="themedComponent_xQWO themedComponent--dark_Lh1h"></div><b class="navbar__title text--truncate">Farm</b></a><button position="left" style="margin-right:2rem;margin-left:2rem;margin-top:0.3rem;width:8rem" class="documate-button" aria-label="Ask AI" data-v-956ba6e9="true"><svg class="icon" viewBox="0 0 12 14" fill="currentColor" data-v-956ba6e9="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.61655 13.3474C6.69072 13.3474 6.75047 13.3232 6.7958 13.2749C6.84525 13.2306 6.87616 13.1721 6.88852 13.0996C6.97094 12.4628 7.0616 11.9269 7.1605 11.4916C7.26352 11.0564 7.39951 10.6997 7.56847 10.4216C7.73742 10.1435 7.96202 9.92194 8.24223 9.75671C8.52245 9.59147 8.88099 9.46454 9.31782 9.37581C9.7587 9.28313 10.2986 9.20257 10.9373 9.13407C11.0156 9.12598 11.0774 9.09776 11.1227 9.04939C11.1722 9.00103 11.1969 8.94061 11.1969 8.86806C11.1969 8.79552 11.1722 8.7351 11.1227 8.68674C11.0774 8.63837 11.0156 8.61015 10.9373 8.60206C10.2986 8.53356 9.7587 8.45498 9.31782 8.36634C8.88099 8.27366 8.52245 8.1447 8.24223 7.97946C7.96202 7.81424 7.73742 7.59259 7.56847 7.31452C7.39951 7.03646 7.26352 6.6798 7.1605 6.24456C7.0616 5.80932 6.97094 5.27132 6.88852 4.63056C6.87616 4.56205 6.84525 4.50563 6.7958 4.4613C6.75047 4.41293 6.69072 4.38876 6.61655 4.38876C6.54237 4.38876 6.48056 4.41293 6.4311 4.4613C6.38578 4.50563 6.35693 4.56205 6.34456 4.63056C6.26627 5.27132 6.17561 5.80932 6.07259 6.24456C5.97369 6.6798 5.8377 7.03646 5.66462 7.31452C5.49566 7.59259 5.27108 7.81424 4.99086 7.97946C4.71064 8.1447 4.35212 8.27366 3.91531 8.36634C3.4785 8.45498 2.93866 8.53356 2.2958 8.60206C2.21751 8.61015 2.15363 8.63837 2.10418 8.68674C2.05473 8.7351 2.03001 8.79552 2.03001 8.86806C2.03001 8.94061 2.05473 9.00103 2.10418 9.04939C2.15363 9.09776 2.21751 9.12598 2.2958 9.13407C2.93454 9.21462 3.47231 9.30533 3.90913 9.4061C4.34594 9.50283 4.70239 9.63175 4.97849 9.79294C5.25871 9.95413 5.48331 10.1718 5.65226 10.4458C5.82122 10.7158 5.95721 11.0664 6.06023 11.4976C6.16325 11.9288 6.25802 12.4628 6.34456 13.0996C6.35693 13.1721 6.38578 13.2306 6.4311 13.2749C6.48056 13.3232 6.54237 13.3474 6.61655 13.3474ZM2.65431 7.00622C2.70377 7.00622 2.74498 6.9901 2.77795 6.95787C2.81091 6.92563 2.82945 6.88734 2.83358 6.84301C2.88714 6.46016 2.94072 6.16396 2.99429 5.9544C3.04786 5.74081 3.13234 5.58163 3.24773 5.47685C3.36311 5.36804 3.53412 5.28341 3.76078 5.22296C3.98742 5.16251 4.30267 5.094 4.70652 5.01744C4.81366 5.00131 4.86723 4.94287 4.86723 4.84212C4.86723 4.79377 4.85074 4.75548 4.81778 4.72727C4.78893 4.69503 4.75185 4.67489 4.70652 4.66682C4.30267 4.6104 3.98536 4.556 3.7546 4.50361C3.52794 4.44719 3.35693 4.36458 3.24155 4.25576C3.13028 4.14293 3.04786 3.9777 2.99429 3.76008C2.94072 3.53843 2.88714 3.23417 2.83358 2.84729C2.82122 2.73848 2.76146 2.68408 2.65431 2.68408C2.54717 2.68408 2.48536 2.7405 2.46888 2.85334C2.42355 3.23215 2.3741 3.52836 2.32053 3.74195C2.26696 3.95553 2.18248 4.11673 2.06709 4.22554C1.95171 4.33032 1.77863 4.41293 1.54786 4.47339C1.32121 4.52981 1.00597 4.59428 0.602121 4.66682C0.494978 4.68698 0.441406 4.74541 0.441406 4.84212C0.441406 4.94287 0.503219 5.00131 0.626846 5.01744C1.02245 5.08594 1.33357 5.14841 1.56023 5.20483C1.791 5.26125 1.96201 5.34386 2.07328 5.45267C2.18454 5.56148 2.26696 5.72469 2.32053 5.94231C2.3741 6.1559 2.42355 6.45412 2.46888 6.83697C2.48536 6.9498 2.54717 7.00622 2.65431 7.00622ZM5.49773 3.08909C5.56366 3.08909 5.60487 3.05281 5.62135 2.98028C5.67493 2.67803 5.72643 2.45638 5.77589 2.31533C5.82534 2.17025 5.92217 2.06749 6.0664 2.00704C6.21064 1.94659 6.45377 1.88815 6.7958 1.83173C6.86998 1.81561 6.90707 1.77531 6.90707 1.71084C6.90707 1.6383 6.86998 1.598 6.7958 1.58993C6.45377 1.52949 6.21064 1.47105 6.0664 1.41463C5.92217 1.35418 5.82534 1.25343 5.77589 1.11238C5.72643 0.967306 5.67493 0.741626 5.62135 0.435348C5.60487 0.362808 5.56366 0.326538 5.49773 0.326538C5.42355 0.326538 5.38234 0.362808 5.3741 0.435348C5.31641 0.741626 5.26283 0.967306 5.21338 1.11238C5.16806 1.25343 5.07121 1.35418 4.92286 1.41463C4.77863 1.47105 4.5355 1.52949 4.19347 1.58993C4.11929 1.598 4.0822 1.6383 4.0822 1.71084C4.0822 1.77531 4.11929 1.81561 4.19347 1.83173C4.5355 1.88815 4.77863 1.94659 4.92286 2.00704C5.07121 2.06749 5.16806 2.17025 5.21338 2.31533C5.26283 2.45638 5.31641 2.67803 5.3741 2.98028C5.38234 3.05281 5.42355 3.08909 5.49773 3.08909Z" data-v-956ba6e9="true"></path></svg><span class="button-placeholder" data-v-956ba6e9="true">Ask AI</span></button><div style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><a class="navbar__item navbar__link" href="/zh/docs/quick-start">指南</a><a class="navbar__item navbar__link" href="/zh/docs/config/configuring-farm">配置</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/api/rust-plugin-api">API</a><a class="navbar__item navbar__link" href="/zh/docs/plugins/official-plugins/overview">插件</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">社区</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/team">团队</a></li><li><a class="dropdown__link" href="/zh/blog/index">日志</a></li><li><a href="https://github.com/farm-fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Awesome Farm<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://discord.com/invite/mDErq9aFnF" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://twitter.com/fe_farm" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/farm-fe/farm?tab=readme-ov-file#chat-with-us" target="_blank" rel="noopener noreferrer" class="dropdown__link">WeChat Group<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/why-farm">1.0.0</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/docs/api/rust-plugin-api">1.0.0</a></li><li><a class="dropdown__link" href="/zh/docs/0.x/api/rust-plugin-api">0.15</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_F1WL"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/api/rust-plugin-api" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/docs/api/rust-plugin-api" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/farm-fe/farm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_fhLg colorModeToggle_Z6MN"><button class="clean-btn toggleButton_V4lX toggleButtonDisabled_foE0" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Vtl_"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Adrb"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Kj8a"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eJvI"><div class="docsWrapper_YABO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_qN9v" type="button"></button><div class="docRoot_Ui2j"><aside class="theme-doc-sidebar-container docSidebarContainer_DAII"><div class="sidebarViewport_RRIt"><div class="sidebar_LJNg"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_BumF menuWithAnnouncementBar_Zs1O"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/docs/api/hmr-api">Api Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/api/hmr-api">Hmr Api</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/api/js-plugin-api">Js Plugin Api</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/api/rust-plugin-api">Rust Plugin Api</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/api/runtime-plugin-api">Runtime Plugin API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/api/javascript-api">JavaScript Api</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/api/rust-api">Rust Api</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_yjID"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DIkG"><div class="docItemContainer_g6kw"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_pWlK" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_olKi"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Api Reference</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Rust Plugin Api</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：1.0.0</span><div class="tocCollapsible_Ms3v theme-doc-toc-mobile tocMobile_A0sM"><button type="button" class="clean-btn tocCollapsibleButton_qSbx">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Rust Plugin Api</h1>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p>本文档仅涵盖插件钩子详情。 有关如何创建、构建和发布 rust 插件，请参阅：<a href="/zh/docs/plugins/writing-plugins/rust-plugin">编写 Rust 插件</a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="配置-rust-插件">配置 Rust 插件<a href="#配置-rust-插件" class="hash-link" aria-label="配置 Rust 插件的直接链接" title="配置 Rust 插件的直接链接">​</a></h2>
<p>通过 <code>plugins</code> 选项添加 Rust 插件：</p>
<div class="language-ts codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockTitle_AzmC">farm.config.ts</div><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-ts codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> defineConfig </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;@farmfe/core&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">default</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">defineConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 在 plugins 中配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  plugins</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;@farmfe/plugin-sass&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><span class="token doc-comment comment" style="color:rgb(152, 159, 177);font-style:italic">/** 插件选项 */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在字符串中配置 Rust 插件包名称（或路径），并在对象中配置其选项。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="编写-rust-插件">编写 Rust 插件<a href="#编写-rust-插件" class="hash-link" aria-label="编写 Rust 插件的直接链接" title="编写 Rust 插件的直接链接">​</a></h2>
<p>有关详细信息，请参阅<a href="/zh/docs/plugins/writing-plugins/rust-plugin">编写 Rust 插件</a>。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="插件-hook-概述">插件 Hook 概述<a href="#插件-hook-概述" class="hash-link" aria-label="插件 Hook 概述的直接链接" title="插件 Hook 概述的直接链接">​</a></h2>
<p>Farm 提供了很多 rollup 风格的 hook，这些 hook 分为 build 阶段和 generate 阶段：
<img decoding="async" loading="lazy" alt="Farm 插件 钩子" src="/zh/assets/images/farm-plugin-hooks-cd6dfe727da737695a51cefe7c30e610.png" width="1698" height="1411" class="img_iF_P"></p>
<p>所有插件挂钩都接受一个名为 <a href="https://docs.rs/farmfe_core/latest/farmfe_core/context/struct.CompilationContext.html" target="_blank" rel="noopener noreferrer"><code>CompilationContext</code></a> 的参数。 所有共享的编译信息都存储在 <code>context</code> 中。</p>
<p>Hook 共有三种（与 Rollup 相同）：</p>
<ul>
<li><code>first</code>：钩子串行执行，当钩子返回非空值时立即返回。 （null 在 JS 中表示 null 和 undefined，在 Rust 中表示 None）。</li>
<li><code>serial</code>: 钩子串行执行，每个钩子的结果将传递到下一个钩子，使用最后一个钩子的结果作为最终结果。</li>
<li><code>parallel</code>：钩子在线程池中并行执行，并且应该被隔离。</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p>有关完整的 <code>Plugin Hooks</code>  定义，请参阅<a href="https://docs.rs/farmfe_core/latest/farmfe_core/plugin/trait.Plugin.html" target="_blank" rel="noopener noreferrer">Plugin Trait</a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="name">name<a href="#name" class="hash-link" aria-label="name的直接链接" title="name的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>true</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>返回此插件的名称。 例子：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">str</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;MyPlugin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="priority">priority<a href="#priority" class="hash-link" aria-label="priority的直接链接" title="priority的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">priority</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">i32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>定义该插件的优先级，值越大，该插件越早执行。 当插件具有相同优先级时，它们将按照与<code>plugins</code>中注册的顺序相同的顺序执行。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p>默认情况下，所有自定义插件的优先级都是 100。有些内部插件的优先级是 99，比如 <code>plugin-script</code>、<code>plugin-css</code>，您可以覆盖默认优先级时内部插件的行为。 但是一些内部插件的优先级是101，比如<code>plugin-resolve</code>，<code>plugin-html</code>，如果你想覆盖默认行为，你应该设置一个更大的优先级。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="config">config<a href="#config" class="hash-link" aria-label="config的直接链接" title="config的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在编译开始之前在<code>config</code>钩子中修改配置。 Config 结构体的定义请参考<a href="https://docs.rs/farmfe_core/latest/farmfe_core/config/struct.Config.html" target="_blank" rel="noopener noreferrer">Config</a>。 例子：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 实现 config hook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 设置 minify 为 false </span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">insert</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;custom-entry&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;./custom.html&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>请注意， <code>Rust Plugin</code> 的 <code>config</code> 钩子是在 <code>JS Plugin</code> 的 <code>config</code> 和 <code>configResolved</code> 钩子之后调用的。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="plugin_cache_loaded">plugin_cache_loaded<a href="#plugin_cache_loaded" class="hash-link" aria-label="plugin_cache_loaded的直接链接" title="plugin_cache_loaded的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">plugin_cache_loaded</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _cache</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token keyword" style="color:rgb(12, 150, 155)">u8</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>扩展插件的持久缓存加载。</p>
<p>当启用 <code>持久缓存</code> 时，在命中缓存时可能会跳过 <code>加载</code> 和 <code>转换</code> 挂钩。 如果您的插件依赖于以前的编译结果（例如，基于现有模块加载虚拟模块），您可能需要实现此钩子来加载插件的缓存信息，以确保缓存按预期工作。</p>
<p>例子：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">CachedStaticAssets</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Resource</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">StaticAssetsPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">plugin_cache_loaded</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    cache</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token keyword" style="color:rgb(12, 150, 155)">u8</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">error</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> cached_static_assets</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">CachedAssets</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token macro property" style="color:rgb(12, 150, 155)">deserialize!</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">CachedStaticAssets</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> asset </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> cached_static_assets</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">list </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourceOrigin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> asset</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">origin </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">emit_file</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">EmitFileParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          resolved_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">to_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> asset</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> asset</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">bytes</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          resource_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> asset</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">resource_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意：</p>
<ul>
<li><code>deserialize</code> 由 <code>farmfe_core</code> 导出，它可以帮助您反序列化 <code>Vec&lt;u8&gt;</code> 中的结构体或枚举。</li>
<li>缓存的结构体或枚举<strong>必须是rkyv可序列化的</strong>，您可以使用<code>farmfe_core</code>公开的<code>#[cache_item]</code>快速创建可缓存的结构体。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="build_start">build_start<a href="#build_start" class="hash-link" aria-label="build_start的直接链接" title="build_start的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>parallel</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">build_start</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title=" 复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在第一次编译开始之前调用。 您可以使用此挂钩来初始化插件的任何初始状态。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p><code>build_start</code> 仅在第一次编译时调用一次。 如果你想在<code>HMR</code>或<code>Lazy Compilation</code>中更新ModuleGraph时做一些事情，你应该使用<a href="#update_modules">update_modules</a>钩子。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="resolve">resolve<a href="#resolve" class="hash-link" aria-label="resolve的直接链接" title="resolve的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>first</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">resolve</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginResolveHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginResolveHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 解析钩子的参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize, Hash, PartialEq, Eq)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginResolveHookParam</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 我们想要解析的源，例如&#x27;./index&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 解析 `specifier` 的起始位置，如果解析入口或解析 hmr 更新，则为 [None]。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> importer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 例如，[ResolveKind::Import] 用于静态导入 (`import a from &#x27;./a&#x27;`)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> kind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResolveKind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Default, Serialize, Deserialize, Clone)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">, default)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginResolveHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 解析路径，通常是绝对文件路径。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resolved_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 该模块是否应该被 external，如果为 true，则该模块不会出现在最终结果中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> external</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">bool</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 是否具有副作用，影响 tree shake</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> side_effects</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">bool</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 从说明符解析的查询，例如，如果说明符是`./a.png?inline`，查询应该是`{ inline: &quot;&quot; }`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 如果你自定义插件，你的插件应该负责解析查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 如果您只想像上面的示例一样进行正常的查询解析， [farmfe_toolkit::resolve::parse_query] 应该会有所帮助</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 插件和钩子之间传递的元数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从 <code>importer</code> 解析自定义 <code>source</code> ，例如从 <code>a.ts</code> 解析 <code>./b</code> ：</p>
<div class="language-ts codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockTitle_AzmC">a.ts</div><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-ts codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> b </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;./b?raw&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// ...</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>那么解析参数将是：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> param </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginResolveHookParam</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;./b&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  importer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> relative_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;a.ts&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> query_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  kind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResolveKind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Import</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>默认解析器的解析结果为：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> resolve_result </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginResolveHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  resolved_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/root/b.ts&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 解析模块的绝对路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  external</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 该模块应该包含在最终编译的资源中，并且不应该是外部的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  side_effects</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 无副作用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token macro property" style="color:rgb(12, 150, 155)">vec!</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;raw&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">new</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>HookContext</code> 用于在您可以递归挂钩时传递状态，例如，您的插件在 <code>resolve hook</code> 中调用 <code>context.plugin_driver.resolve</code>：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">resolve</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">plugin</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginResolveHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">error</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">plugin</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginResolveHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 添加一个守卫以避免无限循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">caller</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">caller </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> caller</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">as_str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;FarmPluginCss&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token macro property" style="color:rgb(12, 150, 155)">matches!</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResolveKind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">CssAtImport</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResolveKind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">CssUrl</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 如果dep以&#x27;~&#x27;开头，则表示它来自node_modules。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 否则它总是相对的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> source </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">striped_source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">strip_suffix</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token char" style="color:rgb(72, 118, 214)">&#x27;~&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        striped_source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">to_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">!</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">starts_with</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token char" style="color:rgb(72, 118, 214)">&#x27;.&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token macro property" style="color:rgb(12, 150, 155)">format!</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;./{}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">clone</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 递归调用resolve</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">plugin_driver</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">resolve</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginResolveHookParam</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(153, 76, 195)">..</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">clone</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          caller</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;FarmPluginCss&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">to_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Default</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">default</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在上面的示例中，我们调用 <code>context.plugin_driver.resolve</code> 并将 <code>caller</code> 作为参数传递，然后我们应该添加一个类似 <code>if caller.as_str() == &quot;FarmPluginCss&quot;</code> 的保护以避免无限循环。</p>
<p>注意：</p>
<ul>
<li>默认情况下，您的<code>resolve hook</code>在Farm内部默认解析器<strong>之后</strong>执行，只有内部解析器无法解析的源才会传递给您的插件，这意味着如果您想覆盖默认解析器 ，您需要将<strong>插件的优先级设置为大于</strong><code>101</code>。</li>
<li>通常 <code>resolved_path</code> 是指向文件的真实绝对路径。 但是您仍然可以返回一个 <code>虚拟模块 id</code> ，例如 <code>virtual:my-module</code> ，但是对于虚拟模块，您需要实现 <code>load</code> 钩子来自定义如何加载虚拟模块。 在 Farm 中，<code>resolved_path + query = module_id</code>。</li>
<li><code>ResolveKind</code> 表示 <code>导入类型</code>，示例值：<code>ResolveKind::Require</code>（由 commonjs require 导入）、<code>ResolveKind::CssImport</code>（由 css 的 import 语句导入）等。</li>
<li><code>meta</code> 可以在插件和钩子之间共享，您可以从任何插件中的 <code>load</code>、<code>transform</code> 和 <code>parse</code> 钩子的参数中获取 <code>meta</code>。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="load">load<a href="#load" class="hash-link" aria-label="load的直接链接" title="load的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>first</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">load</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginLoadHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginLoadHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginLoadHookParam</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 模块id字符串</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 来自解析钩子的解析路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resolved_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 插件和钩子之间传递的元数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginLoadHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 模块的源内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 模块的类型，例如[ModuleType::Js]代表普通的javascript文件，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 通常以 `.js` 扩展名结尾</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>自定义如何从已解析的模块路径或模块 ID 加载模块。 例如加载一个虚拟模块：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">load</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginLoadHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginLoadHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 只处理指定路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">resolved_path </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;virtual:my-plugin&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginLoadHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;import real from &#x27;./real-path&#x27;;&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 <code>load</code> 钩子中加载模块时需要 <code>module_type</code> 和 <code>content</code> 。 <code>source_map</code> 是可选的，如果您在 <code>load</code> 钩子中进行转换（不推荐，我们建议在这种情况下使用 <code>transform</code> 钩子）或者从其他位置加载原始源地图，则可以返回源地图。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="transform">transform<a href="#transform" class="hash-link" aria-label="transform的直接链接" title="transform的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">transform</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginTransformHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginTransformHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginTransformHookParam</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 模块id字符串</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 加载后的源内容或上一个插件转换后的结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 加载后的模块类型或者上一个插件转换后的类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// resolve 的绝对路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resolved_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 之前插件的 source map 链</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> source_map_chain</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Default, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">, default)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginTransformHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 转换后的源内容，将传递给下一个插件。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 您可以在转换后更改模块类型。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 转换后的源映射，所有插件转换后的源映射将存储为源映射链。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 如果为true，则之前的源映射链将被忽略，并且源映射链将重置为该插件返回的[source_map]。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> ignore_previous_source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">bool</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根据**<code>模块内容</code><strong>和</strong><code>模块类型</code>**进行转换。 将 <code>sass</code> 转换为 <code>css</code> 的示例：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 忽略其他代码...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">transform</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">plugin</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginTransformHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token namespace" style="color:rgb(12, 150, 155)">std</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">sync</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">context</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">error</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">plugin</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginTransformHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 模块类型判断是必要的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">module_type </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Custom</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">from</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;sass&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// parse options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> options </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">parse_options</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">module_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// compile sass to css</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> compile_result </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">compileSass</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">plugin</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginTransformHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> compile_result</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">css</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> compile_result</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 告诉 farm 编译器我们已经将此模块转换为 css</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">module</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Css</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ignore_previous_source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写 <code>transform hook</code> 的正常步骤：</p>
<ol>
<li>添加基于 <code>module_type</code> 或 <code>resolved_path</code> 或 <code>module_id</code> 的 <code>if</code> 保护</li>
<li>对 <code>内容</code> 进行转换
3.返回转换后的<code>content</code>、<code>source_map</code>和<code>module_type</code></li>
</ol>
<p>对于 <code>ignore_previous_source_map</code> ，如果您处理了 <code>param.source_map_chain</code> 并折叠了 <code>transform hook</code> 中以前插件的 source map。 您应该将ignore_previous_source_map设置为 <code>true</code> 以确保 source map 正确。 否则，您应该始终将此选项设置为 <code>false</code> 并让 Farm 处理 source map 链。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p><code>transform</code> 钩子是<strong>内容到内容</strong>。 有一个类似的钩子叫做 <code>process_module</code> ， <code>process_module</code> 是<strong>ast to ast</strong>。 所以如果你想转换加载的内容字符串，你需要使用<code>transform</code>钩子，如果你想转换<code>ast</code>，你应该使用<code>process_module</code>钩子。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="parse">parse<a href="#parse" class="hash-link" aria-label="parse的直接链接" title="parse的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>first</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">parse</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginParseHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleMetaData</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginParseHookParam</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// module id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// resolved path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resolved_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// resolved query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// source content(after transform)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 核心插件通过编译共享的模块元数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 核心插件不共享的元数据应存储在 [ModuleMetaData::Custom] 中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">enum</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">ModuleMetaData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Script</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">ScriptModuleMetaData</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Css</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CssModuleMetaData</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Html</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">HtmlModuleMetaData</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Custom</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Box</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token keyword" style="color:rgb(12, 150, 155)">dyn</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">SerializeCustomModuleMetaData</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将**<code>转换后的模块内容</code>**解析为<code>ast</code>。 Farm 原生支持 <code>Js/Jsx/Ts/Tsx</code>、<code>css</code> 和 <code>html</code>。 通常你不需要实现这个钩子，除非你想支持除了<code>Js/Jsx/Ts/Tsx</code>、<code>css</code>和<code>html</code>之外的新的<code>module_type</code>，在这种情况下使用<code>ModuleMetaData::Custom</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="process_module">process_module<a href="#process_module" class="hash-link" aria-label="process_module的直接链接" title="process_module的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">process_module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginProcessModuleHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginProcessModuleHookParam</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleMetaData</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对<code>解析结果</code>进行变换，通常做**<code>ast变换</code>**  。 例如，Farm 将 ts 转换成 js：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">process_module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginProcessModuleHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">!</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">is_script</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 去除 ts 类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">module_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">is_typescript</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token namespace" style="color:rgb(12, 150, 155)">swc_script_transforms</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">strip_typescript</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">cm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// ...ignore other code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在上面的示例中，我们忽略非脚本模块，并且去掉 ts/tsx 模块的 ast 中类型信息。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="analyze_deps">analyze_deps<a href="#analyze_deps" class="hash-link" aria-label="analyze_deps的直接链接" title="analyze_deps的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">analyze_deps</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginAnalyzeDepsHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginAnalyzeDepsHookParam</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 分析了以前插件的依赖关系，您可以为您的插件推送新条目。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> deps</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginAnalyzeDepsHookResultEntry</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分析模块的依赖关系。 例如，我们有 <code>a.ts</code> ：</p>
<div class="language-ts codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockTitle_AzmC">a.ts</div><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-ts codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> b </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;./b&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">require</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;./c&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>那么通常这个钩子应该将<strong>2个条目</strong>推送到<code>params.deps</code>：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">deps</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">push</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginAnalyzeDepsHookResultEntry</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;./b&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">to_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  kind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResolveKind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Import</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">deps</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">push</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginAnalyzeDepsHookResultEntry</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  source</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;./c&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">to_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  kind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResolveKind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Require</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>param.deps</code> 稍后将传递给 <code>resolve</code> 钩子。 您还可以根据需要添加与模块的 ast 不相关的新 deps，Farm 将 <code>resolve</code> 、 <code>load</code> 这些不相关的模块并将它们添加到模块图中。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="finalize_modules">finalize_modules<a href="#finalize_modules" class="hash-link" aria-label="finalize_modules的直接链接" title="finalize_modules的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">finalize_module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginFinalizeModuleHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginFinalizeModuleHookParam</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> deps</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginAnalyzeDepsHookResultEntry</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在密封模块之前做任何你想做的事情。 请注意，您只能修改 <code>param.module</code> 。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="build_end">build_end<a href="#build_end" class="hash-link" aria-label="build_end的直接链接" title="build_end的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>parallel</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// The module graph should be constructed and finalized here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">build_end</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪  贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当从<code>config.input</code>开始的所有依赖都被处理并且<code>ModuleGraph</code>被成功构建时调用，您可以通过<code>context.module_graph</code>在这里获得完整解析的<code>ModuleGraph</code>。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p><code>build_end</code> 仅在第一次编译时调用一次。 如果你想在<code>HMR</code>或<code>Lazy Compilation</code>中更新ModuleGraph时做一些事情，你应该使用<a href="#module_graph_updated">module_graph_updated</a>钩子。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="generate_start">generate_start<a href="#generate_start" class="hash-link" aria-label="generate_start的直接链接" title="generate_start的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>parallel</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">generate_start</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在生成阶段开始之前调用。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="optimize_module_graph">optimize_module_graph<a href="#optimize_module_graph" class="hash-link" aria-label="optimize_module_graph的直接链接" title="optimize_module_graph的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 这里应该对模块图进行一些优化，例如tree shake</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">optimize_module_graph</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _module_graph</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleGraph</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>您可以在此处对 <code>module_graph</code> 进行优化。 对于内部插件，Farm 在这个钩子中进行树摇动和缩小。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="analyze_module_graph">analyze_module_graph<a href="#analyze_module_graph" class="hash-link" aria-label="analyze_module_graph的直接链接" title="analyze_module_graph的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>first</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 根据模块图分析模块组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">analyze_module_graph</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _module_graph</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleGraph</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleGroupGraph</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分析<code>module_graph</code>的**<code>动态导入</code><strong>，并根据</strong><code>动态导入</code>**对模块进行分组，返回分组后的模块。</p>
<div class="theme-admonition theme-admonition-warning admonition_xFJj alert alert--warning"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_JEcN"><p>通常你不应该实现这个钩子，除非你想在 Farm 中实现一个全新的打包算法。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="partial_bundling">partial_bundling<a href="#partial_bundling" class="hash-link" aria-label="partial_bundling的直接链接" title="partial_bundling的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>first</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 局部打包模块到 [Vec&lt;ResourcePot&gt;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">partial_bundling</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _modules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePot</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">ResourcePot</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resource_pot_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  modules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashSet</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotMetaData</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 如果此 [ResourcePot] 不包含入口模块，则 [None]。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// [一些(entry_id)] 否则</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> entry_module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 这个[ResourcePot]中生成的资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  resources</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashSet</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 此 [ResourcePot] 所属的模块组。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 一个[ResourcePot]可以属于多个模块组。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_groups</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashSet</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleGroupId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> immutable</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">bool</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>基于 <code>module_group_graph</code> 和 <code>module_graph</code> 将 <code>modules</code> 打包到 <code>Vec&lt;ResourcePot&gt;</code> 。 <code>ResourcePot</code> 是 Farm 用于保存打包模块的结构，它将被生成到 <a href="#generate_resources">generate_resources</a> 钩子中的最终资源，您可以将 <code>ResourcePot</code> 视为其他工具的 <code>Chunk</code>。</p>
<p>注意：</p>
<ul>
<li>该钩子会在 <code>首次编译</code> 、 <code>HMR</code> 和 <code>延迟编译</code> 中被调用，请确保该钩子不包含副作用（对于相同的模块，始终返回相同的 <code>Vec&lt;ResourcePot&gt;</code> ）。</li>
<li>你应该在这个钩子中设置<code>module.resource_pot</code>。</li>
</ul>
<p>请参阅 Farm 中部分捆绑的<a href="https://github.com/farm-fe/farm/blob/main/crates/plugin_partial_bundling/src/lib.rs" target="_blank" rel="noopener noreferrer">内部实现</a>以获得最佳实践。 请参阅 <a href="https://github.com/farm-fe/farm/blob/main/crates/plugin_partial_bundling/src/lib.rs" target="_blank" rel="noopener noreferrer">RFC-003 部分捆绑</a> 了解 Farm 如何设计捆绑。</p>
<div class="theme-admonition theme-admonition-warning admonition_xFJj alert alert--warning"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_JEcN"><p>通常你不应该实现这个钩子，除非你想在 Farm 中实现一个全新的打包算法。 如果您覆盖此挂钩，除非您遵循与 Farm 相同的打包规范，否则 <code>config.partial_bundling</code> 可能无法工作。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="process_resource_pots">process_resource_pots<a href="#process_resource_pots" class="hash-link" aria-label="process_resource_pots的直接链接" title="process_resource_pots的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 在渲染和生成每个资源之前处理 resource pot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">process_resource_pots</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _resource_pots</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePot</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对 <code>ResourcePots</code> 进行一些<strong>转换</strong>。 注意，此时ResourcePots还没有渲染，这意味着你无法获取<code>ResourcePot</code>的渲染代码，只能添加，删除，改造<code>ResourcePot</code>内部的模块</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="render_start">render_start<a href="#render_start" class="hash-link" aria-label="render_start的直接链接" title="render_start的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">render_start</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 resource pot 渲染之前调用。 渲染 resource pot 后，将产出可执行的 <code>html</code> 、 <code>css</code> 、 <code>js</code> 等文件。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p><code>render_start</code> 仅在第一次编译时调用一次。 <code>HMR</code> 或 <code>Lazy Compilation</code> 不会触发 <code>render_start</code> 钩子。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="render_resource_pot_modules">render_resource_pot_modules<a href="#render_resource_pot_modules" class="hash-link" aria-label="render_resource_pot_modules的直接链接" title="render_resource_pot_modules的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>first</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">render_resource_pot_modules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _resource_pot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotMetaData</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Clone, Debug, serde::Serialize, serde::Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">RenderedModule</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> rendered_content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> rendered_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> rendered_length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">usize</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> original_length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">usize</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Clone, Debug, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">ResourcePotMetaData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> rendered_modules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RenderedModule</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> rendered_content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> rendered_map_chain</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> custom_data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将给定的 <code>ResourcePot</code> 渲染为 <code>rendered_content</code> 和 <code>rendered_source_map_chain</code> 。 该钩子用于将 <code>模块的 ast</code> 渲染为打包代码。 如果您只想修改打包代码，请改用 <a href="#render_resource_pot">render_resource_pot</a>。</p>
<p>如果您确实需要使用此钩子，请参阅 <a href="https://github.com/farm-fe/farm/blob/main/crates/plugin_runtime/src/lib.rs#L320" target="_blank" rel="noopener noreferrer">plugin_runtime</a> 以获得最佳实践。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p>通常，您不应该为原生支持的模块类型（如 <code>js/jsx/ts/tsx/css/html</code> ）覆盖此钩子，只有当您确保要覆盖 Farm 中内部模块类型的默认行为时，才应该使用此钩子， 或者您想支持<strong>自定义模块类型</strong>。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="render_resource_pot">render_resource_pot<a href="#render_resource_pot" class="hash-link" aria-label="render_resource_pot的直接链接" title="render_resource_pot的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">render_resource_pot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginRenderResourcePotHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginRenderResourcePotHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginRenderResourcePotHookParam</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> source_map_chain</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resource_pot_info</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginRenderResourcePotHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>转换给定 <code>ResourcePot</code> 的渲染捆绑代码。 返回 <code>渲染内容</code> 和 <code>source map</code> 。</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">render_resource_pot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginRenderResourcePotHookParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginRenderResourcePotHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">resource_pot_info</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">resource_pot_type </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Css</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginRenderResourcePotHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">replaceAll</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&lt;--layer--&gt;&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> replaced_code</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> replaced_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在上面的示例中，我们转换了 css <code>Resource Pot</code> 的内容，将所有 <code>&lt;--layer--&gt;</code> 替换为 <code>replaced_code</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="augment_resource_hash">augment_resource_hash<a href="#augment_resource_hash" class="hash-link" aria-label="augment_resource_hash的直接链接" title="augment_resource_hash的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">augment_resource_hash</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _render_pot_info</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">ResourcePotInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resource_pot_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_ids</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> modules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RenderedModule</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotInfoData</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复  制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从给定 resource pot 生成资源时附加额外哈希。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="optimize_resource_pot">optimize_resource_pot<a href="#optimize_resource_pot" class="hash-link" aria-label="optimize_resource_pot的直接链接" title="optimize_resource_pot的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 优化资源罐，例如压缩</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">optimize_resource_pot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _resource_pot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">ResourcePot</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotId</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resource_pot_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  modules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashSet</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> meta</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotMetaData</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> entry_module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  resources</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashSet</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> module_groups</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashSet</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleGroupId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> immutable</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">bool</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> info</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Box</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePotInfo</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对渲染的 resource pot 进行一些优化。 例如，替换、压缩等等。 如果要修改此钩子的渲染内容，只需修改 <code>resource_pot.meta.rendered_content</code> 并将此转换的 source map 附加到 <code>resource_pot.meta.rendered_source_map_chain</code> 中。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p>像压缩这样的优化是由 Farm 内部处理的，请确保您确实需要使用这个钩子。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="generate_resources">generate_resources<a href="#generate_resources" class="hash-link" aria-label="generate_resources的直接链接" title="generate_resources的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>first</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 根据[ResourcePot]生成资源，返回[Vec&lt;Resource&gt;]代表最终生成的文件。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 例如一个.js文件及其对应的source map文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">generate_resources</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _resource_pot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourcePot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _hook_context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginHookContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginGenerateResourcesHookResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginGenerateResourcesHookResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Resource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> source_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Resource</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>为给定的渲染 resource pot 生成最终资源。 返回 <code>生成的资源</code> 和 <code>可选的 source map</code> 。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p>对于原生支持的 <code>ModuleTypes</code> ，如 <code>js/ts/jsx/tsx/css/html/static assets</code> ，通常不需要实现此钩子。 当您想要支持 Farm 本身不支持的新型资源时，请使用此钩子。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="finalize_resources">finalize_resources<a href="#finalize_resources" class="hash-link" aria-label="finalize_resources的直接链接" title="finalize_resources的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 对生成的资源做一些终结工作，例如根据生成的资源转换html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">finalize_resources</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginFinalizeResourcesHookParams</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginFinalizeResourcesHookParams</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> resources_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HashMap</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Resource</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对生成的资源进行一些最终的处理工作，例如根据生成的资源转换html（插入<code>&lt;script&gt;</code>、<code>&lt;link&gt;</code>标签）。</p>
<p>您还可以在此处 <strong><code>添加</code></strong> 或 <strong><code>删除</code></strong> 资源。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="generate_end">generate_end<a href="#generate_end" class="hash-link" aria-label="generate_end的直接链接" title="generate_end的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>parallel</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">generate_end</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当所有生成阶段完成时调用（包括 <code>finalize_resources</code> ）。 您可以在这里做一些清理工作。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="finish">finish<a href="#finish" class="hash-link" aria-label="finish的直接链接" title="finish的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>parallel</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">finish</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _stat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Stats</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当所有编译工作完成时调用（包括 <code>构建阶段</code> 和 <code>生成阶段</code> ）。 您可以在这里做一些清理工作。</p>
<div class="theme-admonition theme-admonition-note admonition_xFJj alert alert--secondary"><div class="admonitionHeading_Oflq"><span class="admonitionIcon_h6Ed"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_JEcN"><p><code>finish</code> 仅在第一次编译时调用一次。 <code>HMR</code> 或 <code>Lazy Compilation</code> 不会触发 <code>finish</code> 钩子。 您应该使用 <a href="#update_finished">update_finished</a> 钩子代替。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="write_plugin_cache">write_plugin_cache<a href="#write_plugin_cache" class="hash-link" aria-label="write_plugin_cache的直接链接" title="write_plugin_cache的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">write_plugin_cache</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token keyword" style="color:rgb(12, 150, 155)">u8</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>扩展插件的持久缓存写入。 <code>write_plugin_cache</code> 通常与 <a href="#plugin_cache_loaded">plugin_cache_loaded</a> 一起使用来读写插件的持久缓存。 返回数据的序列化字节。</p>
<p>例如，为静态资源写入缓存：</p>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">impl</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Plugin</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">write_plugin_cache</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">error</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token keyword" style="color:rgb(12, 150, 155)">u8</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> list </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token macro property" style="color:rgb(12, 150, 155)">vec!</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> resources_map </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">resources_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">lock</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> resource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> resources_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">iter</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ResourceOrigin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">resource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">origin </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">module_graph</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">read</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">has_module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">push</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">resource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">clone</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">!</span><span class="token plain">list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">is_empty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">let</span><span class="token plain"> cached_static_assets </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">CachedStaticAssets</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> list </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Some</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token macro property" style="color:rgb(12, 150, 155)">serialize!</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">cached_static_assets</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[cache_item]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">CachedStaticAssets</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Resource</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="update_modules">update_modules<a href="#update_modules" class="hash-link" aria-label="update_modules的直接链接" title="update_modules的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 调用compiler.update(module_paths)时调用。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 在执行 HMR 时可用于执行一些操作，例如清除以前的状态或忽略某些文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">update_modules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _params</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">mut</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginUpdateModulesHookParams</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">, default)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginUpdateModulesHookParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> paths</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">UpdateType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>调用compiler.update(module_paths)时调用。 在执行 HMR 时可用于执行一些操作，例如清除  以前的状态或忽略某些文件</p>
<ul>
<li><code>paths</code> 是将为此更新重新编译的路径</li>
<li>返回新的<code>paths</code>，后续编译将更新返回的新路径。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="module_graph_updated">module_graph_updated<a href="#module_graph_updated" class="hash-link" aria-label="module_graph_updated的直接链接" title="module_graph_updated的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 调用compiler.update(module_paths)时调用。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 用于执行一些操作，例如修改模块图</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">module_graph_updated</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">PluginModuleGraphUpdatedHookParams</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[derive(Debug, Clone, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">#[serde(rename_all = </span><span class="token attribute attr-name string" style="color:rgb(72, 118, 214);font-style:italic">&quot;camelCase&quot;</span><span class="token attribute attr-name" style="color:rgb(72, 118, 214);font-style:italic">, default)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:rgb(17, 17, 17)">PluginModuleGraphUpdatedHookParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> added_modules_ids</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> removed_modules_ids</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">pub</span><span class="token plain"> updated_modules_ids</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Vec</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">ModuleId</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>调用compiler.update(module_paths)时调用。 对于执行一些操作（例如修改模块图）很有用。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="update_finished">update_finished<a href="#update_finished" class="hash-link" aria-label="update_finished的直接链接" title="update_finished的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 调用compiler.update(module_paths)时调用。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">/// 该钩子在所有编译工作完成后调用，包括资源重新生成和终结。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">update_finished</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>调用compiler.update(module_paths)时调用。 该钩子在所有编译工作完成后调用  ，包括资源重新生成和最终处理。</p>
<h2 class="anchor anchorWithStickyNavbar_PvKQ" id="handle_persistent_cached_module">handle_persistent_cached_module<a href="#handle_persistent_cached_module" class="hash-link" aria-label="handle_persistent_cached_module的直接链接" title="handle_persistent_cached_module的直接链接">​</a></h2>
<ul>
<li><strong>required: <code>false</code></strong></li>
<li><strong>hook type: <code>serial</code></strong></li>
<li><strong>default:</strong></li>
</ul>
<div class="language-rust codeBlockContainer_qe3H theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_ZwF_"><pre tabindex="0" class="prism-code language-rust codeBlock_yx9A thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_rBco"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(153, 76, 195);font-style:italic">handle_persistent_cached_module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token keyword" style="color:rgb(12, 150, 155)">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token namespace" style="color:rgb(12, 150, 155)">farmfe_core</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token namespace" style="color:rgb(12, 150, 155)">module</span><span class="token namespace punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  _context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Arc</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">CompilationContext</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Result</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token class-name" style="color:rgb(17, 17, 17)">Option</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token keyword" style="color:rgb(12, 150, 155)">bool</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">Ok</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_Xkfi"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_Octo" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Neix"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_zpYU"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当启用持久缓存并且模块的缓存命中时调用。 返回 <code>true</code> 以<strong>跳过加载此模块的缓存</strong>。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/farm-fe/farm-fe.github.io/tree/main/docs/api/rust-plugin-api.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_yNcj" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_MpL1"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/api/js-plugin-api"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Js Plugin Api</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/api/runtime-plugin-api"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Runtime Plugin API</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_C8Wg thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#配置-rust-插件" class="table-of-contents__link toc-highlight">配置 Rust 插件</a></li><li><a href="#编写-rust-插件" class="table-of-contents__link toc-highlight">编写 Rust 插件</a></li><li><a href="#插件-hook-概述" class="table-of-contents__link toc-highlight">插件 Hook 概述</a></li><li><a href="#name" class="table-of-contents__link toc-highlight">name</a></li><li><a href="#priority" class="table-of-contents__link toc-highlight">priority</a></li><li><a href="#config" class="table-of-contents__link toc-highlight">config</a></li><li><a href="#plugin_cache_loaded" class="table-of-contents__link toc-highlight">plugin_cache_loaded</a></li><li><a href="#build_start" class="table-of-contents__link toc-highlight">build_start</a></li><li><a href="#resolve" class="table-of-contents__link toc-highlight">resolve</a></li><li><a href="#load" class="table-of-contents__link toc-highlight">load</a></li><li><a href="#transform" class="table-of-contents__link toc-highlight">transform</a></li><li><a href="#parse" class="table-of-contents__link toc-highlight">parse</a></li><li><a href="#process_module" class="table-of-contents__link toc-highlight">process_module</a></li><li><a href="#analyze_deps" class="table-of-contents__link toc-highlight">analyze_deps</a></li><li><a href="#finalize_modules" class="table-of-contents__link toc-highlight">finalize_modules</a></li><li><a href="#build_end" class="table-of-contents__link toc-highlight">build_end</a></li><li><a href="#generate_start" class="table-of-contents__link toc-highlight">generate_start</a></li><li><a href="#optimize_module_graph" class="table-of-contents__link toc-highlight">optimize_module_graph</a></li><li><a href="#analyze_module_graph" class="table-of-contents__link toc-highlight">analyze_module_graph</a></li><li><a href="#partial_bundling" class="table-of-contents__link toc-highlight">partial_bundling</a></li><li><a href="#process_resource_pots" class="table-of-contents__link toc-highlight">process_resource_pots</a></li><li><a href="#render_start" class="table-of-contents__link toc-highlight">render_start</a></li><li><a href="#render_resource_pot_modules" class="table-of-contents__link toc-highlight">render_resource_pot_modules</a></li><li><a href="#render_resource_pot" class="table-of-contents__link toc-highlight">render_resource_pot</a></li><li><a href="#augment_resource_hash" class="table-of-contents__link toc-highlight">augment_resource_hash</a></li><li><a href="#optimize_resource_pot" class="table-of-contents__link toc-highlight">optimize_resource_pot</a></li><li><a href="#generate_resources" class="table-of-contents__link toc-highlight">generate_resources</a></li><li><a href="#finalize_resources" class="table-of-contents__link toc-highlight">finalize_resources</a></li><li><a href="#generate_end" class="table-of-contents__link toc-highlight">generate_end</a></li><li><a href="#finish" class="table-of-contents__link toc-highlight">finish</a></li><li><a href="#write_plugin_cache" class="table-of-contents__link toc-highlight">write_plugin_cache</a></li><li><a href="#update_modules" class="table-of-contents__link toc-highlight">update_modules</a></li><li><a href="#module_graph_updated" class="table-of-contents__link toc-highlight">module_graph_updated</a></li><li><a href="#update_finished" class="table-of-contents__link toc-highlight">update_finished</a></li><li><a href="#handle_persistent_cached_module" class="table-of-contents__link toc-highlight">handle_persistent_cached_module</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Guide</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/why-farm">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/farm-fe/farm#chat-with-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">WeChat Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.com/invite/mDErq9aFnF" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/farm-fe/farm" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/@farm-fe" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_hqIV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://github.com/farm-fe/farm" rel="noopener noreferrer" class="footerLogoLink_yggd"><img src="/zh/img/logo-farm.png" alt="Farm Logo" class="footer__logo themedComponent_xQWO themedComponent--light_Flgq"><img src="/zh/img/logo-farm.png" alt="Farm Logo" class="footer__logo themedComponent_xQWO themedComponent--dark_Lh1h"></a></div><div class="footer__copyright">Copyright © 2023 Farm, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>